{"version":3,"sources":["webpack://indb/webpack/universalModuleDefinition","webpack://indb/webpack/bootstrap","webpack://indb/./src/indb.js","webpack://indb/./src/utils.js"],"names":["InDB","options","name","version","stores","asStorage","Array","isArray","length","isKv","request","indexedDB","open","onupgradeneeded","e","db","target","result","existStoreNames","from","objectStoreNames","passStoreNames","forEach","item","objectStore","indexOf","transaction","keyPath","autoIncrement","createObjectStore","indexNames","deleteIndex","indexes","createIndex","unique","multiEntry","push","deleteObjectStore","onblocked","console","error","modifyError","Error","using","use","Promise","resolve","reject","onerror","onsuccess","currentStore","find","store","InDBStore","key","i","keys","then","getItem","get","obj","value","setItem","put","removeItem","connect","close","deleteDatabase","databases","_queue","writable","create","mode","connection","deferer","tx","disconnect","shift","oncomplete","onabort","latest","index","range","direction","onTouch","onDone","onError","owner","openCursor","cursor","fn","next","stop","commit","fns","promises","all","map","batch","keyPah","results","each","parse","count","iterate","offset","start","end","Math","min","reverse","some","items","compare","IDBKeyRange","lowerBound","upperBound","undefined","only","targetObj","targetValue","indexesMapping","compareAandB","a","b","determine","and_conditions","or_conditions","len","current","groups","rules","conditions","optional","isOk","res","objs","add","remove","clear","makeKeyChain","path","chain","toString","split","filter","message"],"mappings":"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","file":"indb.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"indb\"] = factory();\n\telse\n\t\troot[\"indb\"] = factory();\n})(typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { parse, modifyError } from './utils.js'\n\nexport class InDB {\n\tconstructor(options = {}) {\n\t\tlet { name, version = 1, stores } = options\n\t\tconst asStorage = !name\n\n\t\tif (!name) {\n\t\t\tname = '__indb__'\n\t\t}\n\n\t\tif (!stores || !Array.isArray(stores) || !stores.length) {\n\t\t\tstores = [\n\t\t\t\t{\n\t\t\t\t\tname: '__indb__',\n\t\t\t\t\tisKv: true,\n\t\t\t\t},\n\t\t\t]\n\t\t}\n\n\t\tthis.name = name\n\t\tthis.version = version\n\t\tthis.stores = stores\n\n\t\t// update database structure\n\t\tconst request = indexedDB.open(name, version)\n\t\trequest.onupgradeneeded = (e) => {\n\t\t\tconst db = e.target.result\n\t\t\tconst existStoreNames = Array.from(db.objectStoreNames)\n\t\t\tconst passStoreNames = []\n\n\t\t\tstores.forEach((item) => {\n\t\t\t\tlet objectStore = null\n\t\t\t\tif (existStoreNames.indexOf(item.name) > -1) {\n\t\t\t\t\tobjectStore = e.target.transaction.objectStore(item.name)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst keyPath = item.isKv ? 'key' : item.keyPath\n\t\t\t\t\tconst autoIncrement = item.isKv ? false : item.autoIncrement\n\t\t\t\t\tobjectStore = db.createObjectStore(item.name, { keyPath, autoIncrement })\n\t\t\t\t}\n\n\t\t\t\t// delete old indexes\n\t\t\t\tconst indexNames = objectStore.indexNames\n\t\t\t\tif (indexNames && indexNames.length) {\n\t\t\t\t\tArray.from(indexNames).forEach((item) => objectStore.deleteIndex(item))\n\t\t\t\t}\n\n\t\t\t\t// add new indexes\n\t\t\t\tif (item.indexes && item.indexes.length) {\n\t\t\t\t\titem.indexes.forEach((item) => {\n\t\t\t\t\t\tobjectStore.createIndex(item.name, item.keyPath || item.name, { unique: item.unique, multiEntry: Array.isArray(item.keyPath) })\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tpassStoreNames.push(item.name)\n\t\t\t})\n\n\t\t\t// delete objectStores which is not in config information\n\t\t\tif (existStoreNames) {\n\t\t\t\texistStoreNames.forEach((item) => {\n\t\t\t\t\tif (passStoreNames.indexOf(item) === -1) {\n\t\t\t\t\t\tdb.deleteObjectStore(item)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\trequest.onblocked = (e) => {\n\t\t\tconsole.error(modifyError(new Error('indexedDB ' + name + ' is blocked')))\n\t\t}\n\n\t\tthis.using = {}\n\n\t\t// use as a storage like:\n\t\t// const store = new InDB()\n\t\t// store.setItem('key', 'value')\n\t\tif (asStorage) {\n\t\t\treturn this.use(name)\n\t\t}\n\t}\n\tconnect() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst request = indexedDB.open(this.name, this.version)\n\t\t\trequest.onerror = (e) => {\n\t\t\t\treject(modifyError(e))\n\t\t\t}\n\t\t\trequest.onsuccess = (e) => {\n\t\t\t\tresolve(e.target.result)\n\t\t\t}\n\t\t})\n\t}\n\tuse(name) {\n\t\tconst currentStore = this.stores.find(item => item.name === name)\n\n\t\tif (!currentStore) {\n\t\t\tthrow new Error(`[InDB]: store ${name} is not existing.`)\n\t\t}\n\n\t\t// use connected store\n\t\tif (this.using[name]) {\n\t\t\treturn this.using[name]\n\t\t}\n\n\t\tconst store = new InDBStore({\n\t\t\tdb: this,\n\t\t\tstore: currentStore,\n\t\t})\n\n\t\t// if it is a key-value store, append special methods\n\t\tif (currentStore.isKv) {\n\t\t\tstore.key = i => store.keys().then(keys => keys && keys[i])\n\t\t\tstore.getItem = key => store.get(key).then(obj => obj && obj.value)\n\t\t\tstore.setItem = (key, value) => store.put({ key, value })\n\t\t\tstore.removeItem = key => store.delete(key)\n\t\t}\n\n\t\tthis.using[name] = store\n\n\t\treturn store\n\t}\n\tclose() {\n\t\tthis.using = null\n\t\tthis.stores = null\n\n\t\treturn this.connect().then((db) => {\n\t\t\tdb.close()\n\t\t})\n\t}\n}\n\nInDB.deleteDatabase = function(name) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = indexedDB.deleteDatabase(name)\n\t\trequest.onsuccess = () => {\n\t\t\tresolve()\n\t\t}\n\t\trequest.onerror = (e) => {\n\t\t\treject(e)\n\t\t}\n\t})\n}\n\nInDB.databases = function() {\n\treturn indexedDB.databases()\n}\n\nexport default InDB\n\nexport class InDBStore {\n\tconstructor(options = {}) {\n\t\tconst { store, db } = options\n\n\t\tif (typeof store !== 'object' || !store.name || typeof store.name !== 'string') {\n\t\t\tthrow new Error(`[InDBStore]: options.store should be a store config object.`)\n\t\t}\n\n\t\tif (!(db instanceof InDB)) {\n\t\t\tthrow new Error(`[InDBStore]: options.db should be an instanceof InDB.`)\n\t\t}\n\n\t\tthis.store = store\n\t\tthis.db = db\n\t\tthis.name = store.name\n\t\tthis.keyPath = store.isKv ? 'key' : store.keyPath\n\n\t\tthis._queue = []\n\t}\n\n\ttransaction(writable = false) {\n\t\tconst create = () => {\n\t\t\tconst name = this.name\n\t\t\tconst mode = writable ? 'readwrite' : 'readonly'\n\n\t\t\t// share the same connection\n\t\t\tconst connection = this.db.connection\n\t\t\tconst deferer = connection ? Promise.resolve(connection) : this.db.connect()\n\t\t\treturn deferer.then((db) => {\n\t\t\t\tthis.db.connection = db\n\t\t\t\tconst tx = db.transaction(name, mode)\n\t\t\t\tconst disconnect = () => {\n\t\t\t\t\tthis.db.connection = null\n\t\t\t\t\tthis._queue.shift()\n\t\t\t\t}\n\t\t\t\ttx.oncomplete = disconnect\n\t\t\t\ttx.onabort = disconnect\n\t\t\t\ttx.onerror = disconnect\n\t\t\t\treturn tx\n\t\t\t})\n\t\t}\n\n\t\tconst latest = this._queue[this._queue.length - 1]\n\t\tconst deferer = latest ? latest.then(() => create()) : create()\n\t\tthis._queue.push(deferer)\n\t\treturn deferer\n\t}\n\tobjectStore(writable = false) {\n\t\tconst name = this.name\n\t\treturn this.transaction(writable).then(tx => tx.objectStore(name))\n\t}\n\tcursor(options) {\n\t\tconst { index, range, direction, onTouch, onDone, onError, writable = false } = options\n\t\treturn this.objectStore(writable).then((objectStore) => {\n\t\t\tconst owner = index ? objectStore.index(index) : objectStore\n\t\t\tconst request = owner.openCursor(range, direction)\n\t\t\trequest.onsuccess = (e) => {\n\t\t\t\tconst cursor = e.target.result\n\t\t\t\tif (cursor) {\n\t\t\t\t\tonTouch(cursor, owner)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tonDone(cursor, owner)\n\t\t\t\t}\n\t\t\t}\n\t\t\trequest.onerror = (e) => {\n\t\t\t\tonError(modifyError(e))\n\t\t\t}\n\t\t})\n\t}\n\trequest(fn, options = {}) {\n\t\tconst { writable = false } = options\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.objectStore(writable).then((objectStore) => {\n\t\t\t\tconst request = fn(objectStore)\n\t\t\t\trequest.onsuccess = (e) => {\n\t\t\t\t\tconst result = e.target.result\n\t\t\t\t\tresolve(result)\n\t\t\t\t}\n\t\t\t\trequest.onerror = (e) => {\n\t\t\t\t\treject(modifyError(e))\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\titerate(fn, options = {}) {\n\t\tconst { index, range, writable = false, direction = 'next' } = options\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.cursor({\n\t\t\t\tindex,\n\t\t\t\trange,\n\t\t\t\twritable,\n\t\t\t\tdirection,\n\t\t\t\tonTouch: (cursor, owner) => {\n\t\t\t\t\tconst next = () => cursor.continue()\n\t\t\t\t\tconst stop = () => {\n\t\t\t\t\t\t// should commit when writable is true\n\t\t\t\t\t\towner.transaction.commit()\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t}\n\t\t\t\t\tfn(cursor, next, stop)\n\t\t\t\t},\n\t\t\t\tonDone: () => {\n\t\t\t\t\tresolve()\n\t\t\t\t},\n\t\t\t\tonError: (e) => {\n\t\t\t\t\treject(e)\n\t\t\t\t},\n\t\t\t})\n\t\t})\n\t}\n\tbatch(fns, options = {}) {\n\t\tconst { writable = true } = options\n\t\treturn this.transaction(writable).then((tx) => {\n\t\t\tconst name = this.name\n\t\t\tconst promises = []\n\t\t\tconst objectStore = tx.objectStore(name)\n\t\t\tfns.forEach((fn) => {\n\t\t\t\tconst deferer = new Promise((resolve, reject) => {\n\t\t\t\t\tconst request = fn(objectStore)\n\t\t\t\t\trequest.onsuccess = (e) => {\n\t\t\t\t\t\tconst result = e.target.result\n\t\t\t\t\t\tresolve(result)\n\t\t\t\t\t}\n\t\t\t\t\trequest.onerror = (e) => {\n\t\t\t\t\t\treject(modifyError(e))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tpromises.push(deferer)\n\t\t\t})\n\t\t\treturn Promise.all(promises)\n\t\t})\n\t}\n\n\t// ==========================================\n\n\tget(key) {\n\t\t// single key\n\t\tif (!Array.isArray(key)) {\n\t\t\treturn this.request(objectStore => objectStore.get(key))\n\t\t}\n\n\t\t// multiple keys\n\t\tconst keys = key\n\t\tconst fns = keys.map(key => objectStore => objectStore.get(key))\n\t\treturn this.batch(fns, { writable: false })\n\t}\n\tkeys() {\n\t\tconst keyPah = this.keyPath\n\t\tconst results = []\n\t\treturn this.each((obj) => {\n\t\t\tconst key = parse(obj, keyPah)\n\t\t\tresults.push(key)\n\t\t}).then(() => {\n\t\t\treturn results\n\t\t})\n\t}\n\tall() {\n\t\tconst results = []\n\t\treturn this.each((obj) => {\n\t\t\tresults.push(obj)\n\t\t}).then(() => {\n\t\t\treturn results\n\t\t})\n\t}\n\tcount() {\n\t\treturn this.request(objectStore => objectStore.count())\n\t}\n\t// ==========================================\n\teach(fn) {\n\t\treturn this.iterate((cursor, next) => {\n\t\t\tconst obj = cursor.value\n\t\t\tfn(obj)\n\t\t\tnext()\n\t\t})\n\t}\n\treverse(fn) {\n\t\treturn this.iterate((cursor, next) => {\n\t\t\tconst obj = cursor.value\n\t\t\tfn(obj)\n\t\t\tnext()\n\t\t}, { direction: 'prev' })\n\t}\n\tsome(count = 10, offset = 0) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst results = []\n\t\t\tlet i = 0\n\t\t\tlet start = offset\n\t\t\tlet end = offset + count\n\t\t\tlet direction\n\n\t\t\t// offset < 0, means begining from the latest item,\n\t\t\t// for example, offset = -1, means begining from the last item\n\t\t\tif (offset < 0) {\n\t\t\t\tdirection = 'prev'\n\t\t\t\tcount = Math.min(count, -offset)\n\t\t\t\tstart = -(offset + count) || 0\n\t\t\t\tend = start + count\n\t\t\t}\n\n\t\t\tthis.iterate((cursor, next, stop) => {\n\t\t\t\tif (i < start) {\n\t\t\t\t\ti ++\n\t\t\t\t\tnext()\n\t\t\t\t}\n\t\t\t\telse if (i < end) {\n\t\t\t\t\tresults.push(cursor.value)\n\t\t\t\t\ti ++\n\t\t\t\t\tnext()\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tstop()\n\t\t\t\t}\n\t\t\t}, { direction }).then(() => {\n\t\t\t\tif (offset < 0) {\n\t\t\t\t\tresults.reverse()\n\t\t\t\t}\n\t\t\t\tresolve(results)\n\t\t\t}).catch(reject)\n\t\t})\n\t}\n\tfirst() {\n\t\treturn this.some(1).then(items => items[0])\n\t}\n\tlast() {\n\t\treturn this.some(1, -1).then(items => items[0])\n\t}\n\t// =========================\n\tfind(key, value) {\n\t\treturn this.request(objectStore => objectStore.index(key).get(value))\n\t}\n\tquery(key, value, compare) {\n\t\tconst range = (function() {\n\t\t\tswitch (compare) {\n\t\t\t\tcase '>':\n\t\t\t\t\treturn IDBKeyRange.lowerBound(value, true)\n\t\t\t\tcase '>=':\n\t\t\t\t\treturn IDBKeyRange.lowerBound(value)\n\t\t\t\tcase '<':\n\t\t\t\t\treturn IDBKeyRange.upperBound(value, true)\n\t\t\t\tcase '<=':\n\t\t\t\t\treturn IDBKeyRange.upperBound(value)\n\t\t\t\tcase '%':\n\t\t\t\tcase '!=':\n\t\t\t\tcase 'in':\n\t\t\t\t\treturn undefined\n\t\t\t\tdefault:\n\t\t\t\t\treturn IDBKeyRange.only(value)\n\t\t\t}\n\t\t}())\n\n\t\tconst results = []\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.cursor({\n\t\t\t\tindex: key,\n\t\t\t\trange,\n\t\t\t\tonTouch: (cursor, owner) => {\n\t\t\t\t\tconst targetObj = cursor.value\n\t\t\t\t\tconst keyPath = owner.keyPath\n\t\t\t\t\tconst targetValue = parse(targetObj, keyPath)\n\n\t\t\t\t\tif (compare === '!=') {\n\t\t\t\t\t\tif (targetValue !== value) {\n\t\t\t\t\t\t\tresults.push(targetObj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (compare === '%') {\n\t\t\t\t\t\tif (typeof targetValue == 'string' && targetValue.indexOf(value) > -1) {\n\t\t\t\t\t\t\tresults.push(targetObj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (compare === 'in') {\n\t\t\t\t\t\tif (Array.isArray(value) && value.indexOf(targetValue) > -1) {\n\t\t\t\t\t\t\tresults.push(targetObj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tresults.push(targetObj)\n\t\t\t\t\t}\n\n\t\t\t\t\tcursor.continue()\n\t\t\t\t},\n\t\t\t\tonDone: () => {\n\t\t\t\t\tresolve(results)\n\t\t\t\t},\n\t\t\t\tonError: (e) => {\n\t\t\t\t\treject(e)\n\t\t\t\t},\n\t\t\t})\n\t\t})\n\t}\n\tselect(...rules) {\n\t\tconst currentStore = this.store\n\t\tconst indexes = currentStore.indexes || []\n\t\tconst indexesMapping = {}\n\t\tindexes.forEach((item) => {\n\t\t\tconst { name, keyPath } = item\n\t\t\tindexesMapping[name] = keyPath\n\t\t})\n\n\t\tconst compareAandB = function(a, b, compare) {\n\t\t\tif (a === undefined) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tswitch (compare) {\n\t\t\t\tcase '>':\n\t\t\t\t\treturn a > b\n\t\t\t\tcase '>=':\n\t\t\t\t\treturn a >= b\n\t\t\t\tcase '<':\n\t\t\t\t\treturn a < b\n\t\t\t\tcase '<=':\n\t\t\t\t\treturn a <= b\n\t\t\t\tcase '!=':\n\t\t\t\t\treturn a !== b\n\t\t\t\tcase '%':\n\t\t\t\t\treturn typeof a === 'string' && a.indexOf(b) > -1\n\t\t\t\tcase 'in':\n\t\t\t\t\treturn Array.isArray(b) && b.indexOf(a) > -1\n\t\t\t\tdefault:\n\t\t\t\t\treturn a === b\n\t\t\t}\n\t\t}\n\n\t\tconst determine = function(obj, and_conditions, or_conditions) {\n\t\t\tif (!and_conditions.length && !or_conditions.length) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tfor (let i = 0, len = and_conditions.length; i < len; i ++) {\n\t\t\t\tconst { keyPath, value, compare } = and_conditions[i]\n\t\t\t\tconst current = parse(obj, keyPath)\n\t\t\t\tif (!compareAandB(current, value, compare)) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!or_conditions.length) {\n\t\t\t\treturn true\n\t\t\t}\n\n\t\t\tfor (let i = 0, len = or_conditions.length; i < len; i ++) {\n\t\t\t\tconst { keyPath, value, compare } = or_conditions[i]\n\t\t\t\tconst current = parse(obj, keyPath)\n\t\t\t\tif (compareAandB(current, value, compare)) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false\n\t\t}\n\n\t\tconst groups = []\n\t\trules.forEach((conditions) => {\n\t\t\tconst or_conditions = []\n\t\t\tconst and_conditions = []\n\t\t\tfor (let i = 0, len = conditions.length; i < len; i ++) {\n\t\t\t\tconst { key, value, compare, optional } = conditions[i]\n\t\t\t\tconst keyPath = indexesMapping[key] || key // if there is not such index, use original key as keyPath\n\t\t\t\tif (optional) {\n\t\t\t\t\tor_conditions.push({ keyPath, value, compare })\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tand_conditions.push({ keyPath, value, compare })\n\t\t\t\t}\n\t\t\t}\n\t\t\tgroups.push([and_conditions, or_conditions])\n\t\t})\n\n\t\tconst isOk = (obj) => {\n\t\t\tfor (let i = 0, len = groups.length; i < len; i ++) {\n\t\t\t\tconst [and_conditions, or_conditions] = groups[i]\n\t\t\t\tconst res = determine(obj, and_conditions, or_conditions)\n\t\t\t\tif (res) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false\n\t\t}\n\n\t\tconst results = []\n\t\treturn this.each((obj) => {\n\t\t\tif (isOk(obj)) {\n\t\t\t\tresults.push(obj)\n\t\t\t}\n\t\t}).then(() => {\n\t\t\treturn results\n\t\t})\n\t}\n\n\t// =====================================\n\n\tadd(obj, key) {\n\t\tif (Array.isArray(obj)) {\n\t\t\tconst objs = obj\n\t\t\tif (objs.length < 2) {\n\t\t\t\treturn this.add(obj[0], key)\n\t\t\t}\n\n\t\t\tconst fns = objs.map(obj => objectStore => objectStore.add(obj, key))\n\t\t\treturn this.batch(fns)\n\t\t}\n\n\t\tif (!obj) {\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\treturn this.request(objectStore => objectStore.add(obj, key), { writable: true })\n\t}\n\tput(obj, key) {\n\t\tif (Array.isArray(obj)) {\n\t\t\tconst objs = obj\n\t\t\tif (objs.length < 2) {\n\t\t\t\treturn this.put(objs[0], key)\n\t\t\t}\n\n\t\t\tconst fns = objs.map(obj => objectStore => objectStore.put(obj, key))\n\t\t\treturn this.batch(fns)\n\t\t}\n\n\t\tif (!obj) {\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\treturn this.request(objectStore => objectStore.put(obj, key), { writable: true })\n\t}\n\tdelete(key) {\n\t\tif (Array.isArray(key)) {\n\t\t\tconst keys = key\n\t\t\tif (keys.length < 2) {\n\t\t\t\treturn this.delete(keys[0])\n\t\t\t}\n\n\t\t\tconst fns = keys.map(key => objectStore => objectStore.delete(key))\n\t\t\treturn this.batch(fns)\n\t\t}\n\n\t\tif (!key) {\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\treturn this.request(objectStore => objectStore.delete(key), { writable: true })\n\t}\n\tremove(obj) {\n\t\tconst keyPah = this.keyPath\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tconst objs = obj\n\t\t\tif (objs.length < 2) {\n\t\t\t\treturn this.remove(objs[0])\n\t\t\t}\n\n\t\t\tconst fns = objs.map(obj => {\n\t\t\t\tconst key = parse(obj, keyPah)\n\t\t\t\treturn objectStore => objectStore.delete(key)\n\t\t\t})\n\t\t\treturn this.batch(fns)\n\t\t}\n\n\t\tif (!obj) {\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\tconst key = parse(obj, keyPah)\n\t\tif (!key) {\n\t\t\treturn Promise.resolve()\n\t\t}\n\n\t\treturn this.delete(key)\n\t}\n\tclear() {\n\t\treturn this.request(objectStore => objectStore.clear(), { writable: true })\n\t}\n}\n","export function makeKeyChain(path) {\n  let chain = path.toString().split(/\\.|\\[|\\]/).filter(item => !!item)\n  return chain\n}\nexport function parse(obj, path) {\n  if (Array.isArray(path)) {\n    for (let i = 0, len = path.length; i < len; i ++) {\n      const item = path[i]\n      const res = parse(obj, item)\n      if (res !== undefined) {\n        return res\n      }\n    }\n    return\n  }\n\n  let chain = makeKeyChain(path)\n\n  if (!chain.length) {\n    return obj\n  }\n\n  let target = obj\n  for (let i = 0, len = chain.length; i < len; i ++) {\n    let key = chain[i]\n    if (target[key] === undefined) {\n      return\n    }\n    target = target[key]\n  }\n  return target\n}\n\nexport function modifyError(e) {\n  const { message } = e\n  e.message = message.indexOf('[IndexedDB]') === -1 ? '[IndexedDB]: ' + message : message\n  return e\n}\n"],"sourceRoot":""}